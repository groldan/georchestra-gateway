# Structurizr Diagrams for geOrchestra Gateway

This directory contains [Structurizr DSL](https://docs.structurizr.com/dsl/) definitions for generating C4 model diagrams of the geOrchestra Gateway architecture.

## Overview

We use Structurizr to define our architecture in a structured, code-based format that can be version controlled and automatically rendered into diagrams. The DSL files in this directory define:

- `workspace.dsl` - Contains the System Context, Container, and Component views
- `dynamic-views.dsl` - Contains the dynamic runtime views (Authentication Flow and OAuth Flow)

## Diagram Generation

The diagrams are automatically generated by a GitHub Actions workflow whenever changes are made to the DSL files. The workflow:

1. Exports the Structurizr DSL to PlantUML files
2. Renders the PlantUML files to SVG
3. Commits the updated SVG diagrams to the `docs/assets/images/structurizr` directory

## Generating Diagrams Locally

To generate diagrams locally using Docker:

```bash
# Generate PlantUML files from workspace.dsl
docker run --rm -v "$(pwd):/usr/local/structurizr" structurizr/cli export -workspace /usr/local/structurizr/workspace.dsl -format plantuml/c4plantuml -output /usr/local/structurizr/exports

# Generate PlantUML files from dynamic-views.dsl
docker run --rm -v "$(pwd):/usr/local/structurizr" structurizr/cli export -workspace /usr/local/structurizr/dynamic-views.dsl -format plantuml/c4plantuml -output /usr/local/structurizr/exports
```

Then, convert the PlantUML files to SVG:

```bash
# Generate SVG files from PlantUML files
docker run --rm -v "$(pwd):/data" plantuml/plantuml -tsvg "/data/exports/*.puml" -o "/data/../assets/images/structurizr"
```

## Adding New Diagrams

To add a new diagram:

1. Update the appropriate DSL file with your changes
2. For dynamic views, make sure to define all relationships in the model section first
3. Commit your changes and push to GitHub
4. The GitHub Actions workflow will automatically generate the diagrams

## Important Notes

- When defining dynamic views, all relationships used in the dynamic view must be defined in the model section
- You can't use relationships in dynamic views that don't exist in the model
- If you need to add a new relationship type, add it to the model section first